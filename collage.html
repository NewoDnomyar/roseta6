<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collage Maker</title>
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="collage.css">
    <script src="collage.js"></script>

</head>
<body>

    <div class="navbar">
        <div class="logo">Photo Collage Maker</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="collage.html" class="nav-link active">Create Collage</a>
            <a href="checkout.html" class="nav-link">Checkout</a>
            <a href="library.html" class="nav-link">Library</a>
        </div>
    </div>

    <div class="sidebar">
        <h2>Select a Tile</h2>
        <select id="tileSelector">
            <option value="" disabled selected>Select a tile</option>
        </select>

        <div id="selectedTilesContainer"></div>

        <div id="rosetacodeID">Roseta Code: </div>

        <button id="clearRSID" class="button clear-button">Clear RSID</button>
    </div>

    <div class="main-content">
        <h1>Collage Maker</h1>

        <h2>Front Canvas</h2>
        <canvas id="frontCanvas" width="1700" height="1100"></canvas>

        <h2>Back Canvas</h2>
        <canvas id="backCanvas" width="1700" height="1100"></canvas>

        <a href="checkout.html" class="button">Continue to Checkout</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tileSelector = document.getElementById('tileSelector');
            const selectedTilesContainer = document.getElementById('selectedTilesContainer');
            const rosetaCodeElement = document.getElementById('rosetacodeID');
            const frontCanvas = document.getElementById('frontCanvas');
            const backCanvas = document.getElementById('backCanvas');
            const frontCtx = frontCanvas.getContext('2d');
            const backCtx = backCanvas.getContext('2d');
            const clearRSIDButton = document.getElementById('clearRSID');

            let selectedTiles = [];
            let collageCode = '';

            const images = [
                { id: 'tl1', src: 'assets/tiles/tl1 volume & capacity.png', name: 'volume & capacity' },
                { id: 'tl2', src: 'assets/tiles/tl2 weight+mass.png', name: 'weight+mass' },
                { id: 'tl3', src: 'assets/tiles/tl3 time.png', name: 'time' },
                { id: 'tl4', src: 'assets/tiles/tl4 speed.png', name: 'speed' },
                { id: 'tl5', src: 'assets/tiles/tl5 power.png', name: 'power' },
                { id: 'tl6', src: 'assets/tiles/tl6 energy.png', name: 'energy' },
                { id: 'tl7', src: 'assets/tiles/tl7 digital storage.png', name: 'digital storage' },
                { id: 'tl8', src: 'assets/tiles/tl8 power.png', name: 'power' },
                { id: 'tl9', src: 'assets/tiles/tl9 pressure.png', name: 'pressure' },
                { id: 'tl10', src: 'assets/tiles/tl10 angles.png', name: 'angles' },
                { id: 'tl11', src: 'assets/tiles/tl11 currency.png', name: 'currency' },
                { id: 'tl12', src: 'assets/tiles/tl12 cooking.png', name: 'cooking' },
                { id: 'tl13', src: 'assets/tiles/tl13 constitutional law.png', name: 'constitutional law' },
                { id: 'tl14', src: 'assets/tiles/tl14 contract law.png', name: 'contract law' },
                { id: 'tl15', src: 'assets/tiles/tl15 criminal law.png', name: 'criminal law' },
                { id: 'tl16', src: 'assets/tiles/tl16 business law.png', name: 'business law' },
                { id: 'tl17', src: 'assets/tiles/tl17 property law.png', name: 'property law' },
                { id: 'tl18', src: 'assets/tiles/tl18 tort law.png', name: 'tort law' },
                { id: 'tl19', src: 'assets/tiles/tl19 software development.png', name: 'software development' },
                { id: 'tl20', src: 'assets/tiles/tl20 cybersecurity.png', name: 'cybersecurity' },
                { id: 'tl21', src: 'assets/tiles/tl21 networking basics.png', name: 'networking basics' },
                { id: 'tl22', src: 'assets/tiles/tl22 computer architecture.png', name: 'computer architecture' },
                { id: 'tl23', src: 'assets/tiles/tl23 common algorithms.png', name: 'common algorithms' },
                { id: 'tl24', src: 'assets/tiles/tl24 data structures.png', name: 'data structures' },
                { id: 'tl25', src: 'assets/tiles/tl25 basic programming concepts.png', name: 'basic programming concepts' },
                { id: 'tl26', src: 'assets/tiles/tl26 cognitive biases.png', name: 'cognitive biases' },
                { id: 'tl27', src: 'assets/tiles/tl27 learning theories.png', name: 'learning theories' },
                { id: 'tl28', src: 'assets/tiles/tl28 mental health disorders.png', name: 'mental health disorders' },
                { id: 'tl29', src: 'assets/tiles/tl29 therapeutic approaches.png', name: 'therapeutic approaches' },
                { id: 'tl30', src: 'assets/tiles/tl30 syntax.png', name: 'syntax' },
                { id: 'tl31', src: 'assets/tiles/tl31 phonetics.png', name: 'phonetics' },
                { id: 'tl32', src: 'assets/tiles/tl32 morphology.png', name: 'morphology' },
                { id: 'tl33', src: 'assets/tiles/tl33 semantics.png', name: 'semantics' },
                { id: 'tl34', src: 'assets/tiles/tl34 pragmatics.png', name: 'pragmatics' },
                { id: 'tl35', src: 'assets/tiles/tl35 advanced vocabulary.png', name: 'advanced vocabulary' },
                { id: 'tl36', src: 'assets/tiles/tl36 business vocabulary.png', name: 'business vocabulary' },
                { id: 'tl37', src: 'assets/tiles/tl37 academic vocabulary.png', name: 'academic vocabulary' },
                { id: 'tl38', src: 'assets/tiles/tl38 common suffixes.png', name: 'common suffixes' },
                { id: 'tl39', src: 'assets/tiles/tl39 cooking techniques.png', name: 'cooking techniques' },
                { id: 'tl40', src: 'assets/tiles/tl40 nutrition macronutrients.png', name: 'nutrition macronutrients' },
                { id: 'tl41', src: 'assets/tiles/tl41 herbs & spices.png', name: 'herbs & spices' },
                { id: 'tl42', src: 'assets/tiles/tl42 dietary requirements.png', name: 'dietary requirements' },
                { id: 'tl43', src: 'assets/tiles/tl43 holy days.png', name: 'holy days' },
                { id: 'tl44', src: 'assets/tiles/tl44 10 commandments.png', name: '10 commandments' },
                { id: 'tl45', src: 'assets/tiles/tl45 the beatitudes.png', name: 'the beatitudes' },
                { id: 'tl46', src: 'assets/tiles/tl46 the fruit of the spirit.png', name: 'the fruit of the spirit' },
                { id: 'tl47', src: 'assets/tiles/tl47 the lords prayer.png', name: 'the lords prayer' }
            ];

            function loadTileSelector() {
                images.forEach(image => {
                    const option = document.createElement('option');
                    option.value = image.id;
                    option.textContent = image.name;
                    tileSelector.appendChild(option);
                });
            }

            function updateCollageCode() {
                collageCode = selectedTiles.map((tile, index) => `${index + 1}:${tile.id}`).join('|');
                rosetaCodeElement.textContent = `Roseta Code: ${collageCode}`;
                localStorage.setItem('rsidCode', collageCode);
                drawCollage(); // Update the canvases each time the code is updated
            }

            function drawCollage() {
                frontCtx.clearRect(0, 0, frontCanvas.width, frontCanvas.height); // Clear the front canvas
                backCtx.clearRect(0, 0, backCanvas.width, backCanvas.height); // Clear the back canvas

                const tileWidth = 324; // Credit card width in pixels (3.375 inches * 96 DPI)
                const tileHeight = 204; // Credit card height in pixels (2.125 inches * 96 DPI)
                const tilesPerRow = Math.floor(frontCanvas.width / tileWidth);

                selectedTiles.forEach((tile, index) => {
                    const imgElement = new Image();
                    imgElement.src = tile.src;

                    imgElement.onload = function() {
                        const x = (index % tilesPerRow) * tileWidth;
                        const y = Math.floor(index / tilesPerRow) * tileHeight;

                        if (index < tilesPerRow * Math.floor(frontCanvas.height / tileHeight)) {
                            // Place tile on the front canvas
                            frontCtx.drawImage(imgElement, x, y, tileWidth, tileHeight);
                            drawGridLines(frontCtx, x, y, tileWidth, tileHeight); // Draw grid lines around the tile
                        } else {
                            // Place tile on the back canvas
                            const backIndex = index - tilesPerRow * Math.floor(frontCanvas.height / tileHeight);
                            const backX = (backIndex % tilesPerRow) * tileWidth;
                            const backY = Math.floor(backIndex / tilesPerRow) * tileHeight;
                            backCtx.drawImage(imgElement, backX, backY, tileWidth, tileHeight);
                            drawGridLines(backCtx, backX, backY, tileWidth, tileHeight); // Draw grid lines around the tile
                        }
                    };
                });
            }

            function drawGridLines(ctx, x, y, width, height) {
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, width, height); // Draw grid lines
            }

            tileSelector.addEventListener('change', function() {
                const selectedTileId = tileSelector.value;
                const selectedTile = images.find(image => image.id === selectedTileId);

                if (selectedTiles.length < 48) {
                    selectedTiles.push(selectedTile);

                    const imgElement = document.createElement('img');
                    imgElement.src = selectedTile.src;
                    selectedTilesContainer.appendChild(imgElement);

                    updateCollageCode();
                } else {
                    alert("You have reached the maximum number of tiles (48).");
                }
                tileSelector.value = ""; // Reset the dropdown menu
            });

            clearRSIDButton.addEventListener('click', clearRSID);

            function clearRSID() {
                selectedTiles = [];
                collageCode = '';
                selectedTilesContainer.innerHTML = '';
                rosetaCodeElement.textContent = 'Roseta Code: ';
                localStorage.removeItem('rsidCode');
                frontCtx.clearRect(0, 0, frontCanvas.width, frontCanvas.height); // Clear the front canvas
                backCtx.clearRect(0, 0, backCanvas.width, backCanvas.height); // Clear the back canvas
            }

            loadTileSelector();

            const storedRosetaCode = localStorage.getItem('rsidCode');
            if (storedRosetaCode) {
                collageCode = storedRosetaCode;
                rosetaCodeElement.textContent = `Roseta Code: ${collageCode}`;

                const tilePairs = collageCode.split('|');
                tilePairs.forEach(pair => {
                    const [index, tileId] = pair.split(':');
                    const tile = images.find(image => image.id === tileId);
                    if (tile) {
                        selectedTiles.push(tile);
                        const imgElement = document.createElement('img');
                        imgElement.src = tile.src;
                        selectedTilesContainer.appendChild(imgElement);
                    }
                });

                drawCollage(); // Draw the collage based on the stored Roseta code
            }
        });
    </script>

</body>
</html>
